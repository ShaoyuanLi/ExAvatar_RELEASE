#!/bin/sh

# --- 配置区 ---
# 1. 要无限重试直到成功的命令
COMMAND="python train.py --subject_id Jiali --continue"

# 2. 每次重试前的等待时间（秒）
RETRY_DELAY=10
# --- 配置结束 ---

# 无限循环
while true
do
    echo "======================================================="
    echo ">>> [$(date +'%Y-%m-%d %H:%M:%S')] 正在尝试执行命令..."
    echo ">>> $COMMAND"
    echo "======================================================="

    # 直接执行命令。输出会直接显示在屏幕上。
    $COMMAND

    # 获取刚刚执行命令的退出码
    exit_code=$?

    # 检查命令是否成功
    if [ $exit_code -eq 0 ]; then
        # 如果成功 (退出码为0)，打印成功信息并跳出循环
        echo "======================================================="
        echo ">>> [$(date +'%Y-%m-%d %H:%M:%S')] 命令成功完成！脚本退出。"
        echo "======================================================="
        break
    else
        # 如果失败 (退出码非0)，打印失败信息并准备重试
        echo # 添加一个空行以提高可读性
        echo "-------------------------------------------------------"
        echo ">>> [$(date +'%Y-%m-%d %H:%M:%S')] 命令执行失败！"
        echo ">>> 退出码: $exit_code"
        echo ">>> 将在 $RETRY_DELAY 秒后自动重试..."
        echo "-------------------------------------------------------"
        
        # 等待指定时间
        sleep $RETRY_DELAY
    fi
done
